<div class="dashboard">
  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <div class="logo">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M12 2L2 7L12 12L22 7L12 2Z" fill="white"/>
          <path d="M2 17L12 22L22 17" stroke="white" stroke-width="2"/>
        </svg>
      </div>
      <h1>Users Dashboard</h1>
    </div>
    <div class="header-right">
      <span class="welcome">Welcome, <strong>admin</strong></span>
      <button class="btn-logout" (click)="logout()">
        <svg width="16" height="16" viewBox="0 0 16 16">
          <path d="M6 2H2v12h4M11 12l4-4-4-4M15 8H6" stroke="currentColor" stroke-width="1.5"/>
        </svg>
        Logout
      </button>
    </div>
  </header>

<!-- основной контент -->
  <main class="content">
    <!-- Search & Add Section -->
    <div class="toolbar">
      <div class="search-box">
        <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20">
          <circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="2" fill="none"/>
          <path d="M12 12l6 6" stroke="currentColor" stroke-width="2"/>
        </svg>
        <input
          type="text"
          placeholder="Search users by name"
          [formControl]="searchControl"
          class="search-input"
        />
      </div>
      <button class="btn-add" (click)="toggleAddForm()">
        <svg width="20" height="20" viewBox="0 0 20 20">
          <path d="M10 4v12M4 10h12" stroke="white" stroke-width="2"/>
        </svg>
        Add User
      </button>
    </div>

    <!-- User Form-->
    <div *ngIf="showAddForm" class="add-user-modal" (click)="toggleAddForm()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <h3>Добавить нового пользователя</h3>
        <div class="form-group">
          <label>Имя <span class="required">*</span></label>
          <input type="text" placeholder="Введите имя" [(ngModel)]="newUserName" />
        </div>
        <div class="form-group">
          <label>Username <span class="required">*</span></label>
          <input type="text" placeholder="Введите username" [(ngModel)]="newUserUsername" />
        </div>
        <div class="form-group">
          <label>Email <span class="required">*</span></label>
          <input type="email" placeholder="Введите email" [(ngModel)]="newUserEmail" />
        </div>
        <div class="form-group">
          <label>Город</label>
          <input type="text" placeholder="Город (необязательно)" [(ngModel)]="newUserCity" />
        </div>
        <div class="form-group">
          <label>Компания</label>
          <input type="text" placeholder="Название компании (необязательно)" [(ngModel)]="newUserCompany" />
        </div>
        <div class="form-actions">
          <button class="btn-cancel" (click)="toggleAddForm()">Отмена</button>
          <button class="btn-save" (click)="addUser()" [disabled]="!newUserName || !newUserUsername || !newUserEmail">
            Сохранить
          </button>
        </div>
      </div>
    </div>

    <!-- User Count -->
    <div class="user-count">{{ filteredUsers().length }} users</div>

    <!-- Loading State -->
    <div *ngIf="userService.loading()" class="state-loading">
      <div class="spinner"></div>
      <p>Загрузка данных...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="userService.error()" class="state-error">
      <p>⚠️ {{ userService.error() }}</p>
      <button (click)="userService.loadUsers()">Попробовать снова</button>
    </div>

    <!-- Users Grid -->
    <div *ngIf="!userService.loading() && !userService.error()" class="users-grid">
      <!-- Empty State -->
      <div *ngIf="filteredUsers().length === 0" class="state-empty">
        <p>Пользователи не найдены</p>
      </div>

      <!-- User Cards -->
      <div *ngFor="let user of filteredUsers(); trackBy: trackById" class="user-card">
        <div class="card-header">
          <h3>{{ user.name }}</h3>
          <button class="btn-delete" (click)="openDeleteConfirm(user.id)">
            <svg width="16" height="16" viewBox="0 0 16 16">
              <path d="M2 4h12M6 4V2h4v2M3 4l1 10h8l1-10" stroke="currentColor" stroke-width="1.5" fill="none"/>
            </svg>
          </button>
        </div>
        <div class="card-body">
          <div class="info-row">
            <svg width="14" height="14" viewBox="0 0 14 14">
              <path d="M2 3h10a1 1 0 011 1v7a1 1 0 01-1 1H2a1 1 0 01-1-1V4a1 1 0 011-1z" stroke="currentColor" fill="none"/>
              <path d="M13 4L7 8 1 4" stroke="currentColor"/>
            </svg>
            <span>{{ user.email }}</span>
          </div>
          <div class="info-row" *ngIf="user.address">
            <svg width="14" height="14" viewBox="0 0 14 14">
              <path d="M7 1a4 4 0 00-4 4c0 3 4 8 4 8s4-5 4-8a4 4 0 00-4-4z" stroke="currentColor" fill="none"/>
              <circle cx="7" cy="5" r="1.5" fill="currentColor"/>
            </svg>
            <span>{{ user.address?.city }}</span>
          </div>
          <div class="info-row" *ngIf="user.username">
            <svg width="14" height="14" viewBox="0 0 14 14">
              <circle cx="7" cy="4" r="2" stroke="currentColor" fill="none"/>
              <path d="M2 12a5 5 0 0110 0" stroke="currentColor" fill="none"/>
            </svg>
            <span>@{{ user.username }}</span>
          </div>
          <div class="info-row" *ngIf="user.company">
            <svg width="14" height="14" viewBox="0 0 14 14">
              <rect x="2" y="2" width="10" height="10" rx="1" stroke="currentColor" fill="none"/>
              <path d="M2 6h10M6 2v10" stroke="currentColor"/>
            </svg>
            <span>{{ user.company?.name }}</span>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Custom Delete Confirmation Popup -->
  <div *ngIf="showDeleteConfirm" class="delete-modal" (click)="closeDeleteConfirm()">
    <div class="delete-popup" (click)="$event.stopPropagation()">
      <div class="popup-icon">
        <svg width="48" height="48" viewBox="0 0 48 48">
          <circle cx="24" cy="24" r="22" fill="#fee2e2" stroke="#dc2626" stroke-width="2"/>
          <path d="M24 16v12M24 32v2" stroke="#dc2626" stroke-width="3" stroke-linecap="round"/>
        </svg>
      </div>
      <h3>Подтвердите удаление</h3>
      <p>Вы уверены, что хотите удалить этого пользователя? Это действие нельзя отменить.</p>
      <div class="popup-actions">
        <button class="btn-cancel" (click)="closeDeleteConfirm()">Отмена</button>
        <button class="btn-delete-confirm" (click)="confirmDelete()">Удалить</button>
      </div>
    </div>
  </div>
</div>



<!-- 


  <div *ngIf="userService.loading()" class="state-container loader">
    <div class="spinner"></div>
    <p>Загрузка данных...</p>
  </div>

  <div *ngIf="userService.error()" class="state-container error">
    <p>⚠️ {{ userService.error() }}</p>
    <button (click)="userService.loadUsers()">Попробовать снова</button>
  </div>

  <div *ngIf="!userService.loading() && !userService.error()">
    <div *ngIf="filteredUsers().length === 0" class="state-container empty">
      <p>Пользователи не найдены</p>
    </div>

    <ul *ngIf="filteredUsers().length > 0" class="users-list">
      <li *ngFor="let user of filteredUsers(); trackBy: trackById" class="user-item">
        <div class="user-info">
          <span class="user-name">{{ user.name }}</span>
          <span class="user-email">{{ user.email }}</span>
        </div>
      </li>
    </ul>
  </div>


 -->



